---
// src/components/PcbShowcase.astro
import { pcbModelsData as rawPcbModelsData } from "../data/pcbModels.js";

interface PcbModel {
    key: string;
    name: string;
    modelPath: string;
    thumbnailUrl: string;
    githubUrl?: string; // Make githubUrl optional
}

const pcbModelsData: PcbModel[] = rawPcbModelsData;
console.log('[Astro SSR] PcbShowcase.astro - pcbModelsData:', pcbModelsData);
const pcbModelsDataJson = JSON.stringify(pcbModelsData);

// Placeholder for any server-side logic or props needed.
// For example, you might pass a prop to enable/disable this section.
---

<section id="pcb-3d-showcase" class="artifact-section content-section" data-pcb-models={pcbModelsDataJson}>
    <div class="container">
        <div class="artifact-header stagger-children">
            <h2>3D PCB Showcase</h2>
            <div class="pcb-thumbnail-selector-wrapper">
                <button
                    class="scroll-arrow prev-arrow"
                    aria-label="Previous Model"></button>
                <div class="pcb-thumbnail-selector">
                    <!-- Thumbnails will be dynamically generated by client-side JS -->
                    <!-- Alternatively, could render initial set here if pcbModelsData is available -->
                    {
                        pcbModelsData.map((model, index) => (
                            <div
                                class="pcb-thumbnail-item"
                                data-model-key={model.key}
                                style={`--animation-order-child: ${index};`}
                            >
                                {model.thumbnailUrl ? (
                                    <img
                                        src={model.thumbnailUrl}
                                        alt={model.name}
                                        loading="lazy"
                                    />
                                ) : (
                                    <div
                                        class="placeholder-thumb-visual"
                                        style={`background-color: hsl(${index * 60}, 70%, 70%)`}
                                    >
                                        {model.name
                                            .substring(0, 1)
                                            .toUpperCase()}
                                    </div>
                                )}
                                <span>{model.name}</span>
                                {model.githubUrl && (
                                    <a href={model.githubUrl} target="_blank" rel="noopener noreferrer" class="pcb-github-link" title="View on GitHub">
                                        <!-- Using a generic 'link' icon for now, replace with a proper GitHub/code icon if available -->
                                        <span class="material-symbols-rounded">link</span>
                                    </a>
                                )}
                            </div>
                        ))
                    }
                </div>
                <button class="scroll-arrow next-arrow" aria-label="Next Model"
                    >></button
                >
            </div>
            <div class="artifact-meta-pills">
                <span class="meta-pill-label">Rendered with:</span>
                <span class="meta-pill">Three.js</span>
                <span class="meta-pill">WebGL</span>
                <span class="meta-pill">Custom Shaders</span>
            </div>
        </div>
        <div id="pcb-3d-render-container">
            <div id="loading-indicator">Loading 3D Model...</div>
            <!-- Canvas for Three.js will be appended here by script -->
        </div>
        <div class="artifact-description stagger-children">
            <p>
                This section showcases 3D representations of custom PCB designs,
                rendered in real-time. Select a model above. Interact with the
                model using your mouse (drag to rotate, scroll to zoom,
                right-click/two-finger drag to pan). When using actual GLB
                models with defined hotspots, hovering over components will show
                annotations.
                <strong
                    >(Describe the PCB projects, key components, and any
                    interesting aspects.)</strong
                >
            </p>
        </div>
    </div>
</section>

<!-- No client:* directive, Astro processes scripts from src/ by default -->
<script src="../scripts/pcbShowcaseLogic.js"></script>

<style>
    /* Styles for .placeholder-thumb-visual if not covered globally */
    .placeholder-thumb-visual {
        width: 100%;
        height: 50px; /* Match original .pcb-thumbnail-item img */
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 1.5rem; /* Larger for single initial */
        font-weight: bold;
        color: white;
        border-radius: calc(
            var(--border-radius-base) - 2px
        ); /* Match original */
        margin-bottom: var(--spacing-xs); /* Match original */
    }

    .pcb-thumbnail-item {
        /* Ensure it can contain positioned children if needed, though not strictly for this link */
        /* position: relative; */
        /* Making sure the item itself doesn't grow too large if content pushes it */
        display: flex;
        flex-direction: column;
        align-items: center;
    }

    .pcb-github-link {
        display: inline-block;
        margin-top: 4px;
        color: var(--color-foreground-muted);
        text-decoration: none;
        line-height: 1;
    }

    .pcb-github-link:hover {
        color: var(--color-accent-primary);
    }

    .pcb-github-link .material-symbols-rounded {
        font-size: 1rem;
        vertical-align: middle;
    }

    .pcb-thumbnail-selector.is-centered {
        justify-content: center;
    }

    /* Class to hide elements, controlled by JS */
    .pcb-thumbnail-selector-wrapper .scroll-arrow.hidden,
    .pcb-thumbnail-selector-wrapper.no-scroll-fades::before,
    .pcb-thumbnail-selector-wrapper.no-scroll-fades::after {
        display: none !important; /* Important to override other display styles if necessary */
        opacity: 0 !important; /* Ensure fades are also gone */
    }
</style>
